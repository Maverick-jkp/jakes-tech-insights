<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Site.Title }} - {{ .Site.Params.description }}</title>
    <meta name="description" content="{{ .Site.Params.description }}">
    <meta name="keywords" content="{{ delimit .Site.Params.keywords ", " }}">
    <meta name="author" content="{{ .Site.Params.author }}">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- Resource Hints -->
    {{ partial "resource-hints.html" . }}

    <!-- Canonical URL -->
    {{ partial "canonical.html" . }}

    <!-- Hreflang for multilingual SEO -->
    {{ partial "hreflang.html" . }}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ .Site.Title }}">
    <meta property="og:description" content="{{ .Site.Params.description }}">
    <meta property="og:image" content="{{ .Site.BaseURL }}/favicon.svg">
    <meta property="og:site_name" content="{{ .Site.Title }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ .Permalink }}">
    <meta name="twitter:title" content="{{ .Site.Title }}">
    <meta name="twitter:description" content="{{ .Site.Params.description }}">
    <meta name="twitter:image" content="{{ .Site.BaseURL }}/favicon.svg">

    <!-- Schema.org JSON-LD for Organization/WebSite -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "name": "{{ .Site.Title }}",
          "url": "{{ .Site.BaseURL }}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{ .Site.BaseURL }}/favicon.svg",
            "width": 600,
            "height": 60
          }
        },
        {
          "@type": "WebSite",
          "name": "{{ .Site.Title }}",
          "url": "{{ .Site.BaseURL }}",
          "description": "{{ .Site.Params.description }}",
          "publisher": {
            "@type": "Organization",
            "name": "{{ .Site.Title }}"
          },
          "inLanguage": ["en", "ko", "ja"]
        }
      ]
    }
    </script>

    <!-- Force Dark Theme -->
    <script>
        document.documentElement.setAttribute('data-theme', 'dark');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2478912111812328"
         crossorigin="anonymous"></script>

    {{ with site.Config.Services.GoogleAnalytics.ID }}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ . }}');
    </script>
    {{ end }}
    <link rel="stylesheet" href="{{ "css/homepage.css" | relURL }}">
</head>
<body lang="{{ .Site.Language.Lang }}">
    <!-- Fixed Header -->
    <div class="top-bar">
        <div class="header-box">
            <a href="/{{ .Site.Language.Lang }}/" class="logo">
                JAKE<span class="apostrophe">'</span>S INSIGHTS
            </a>
            <div class="lang-switch">
                {{- /* Dynamic language switcher using Hugo's translation links */ -}}
                {{- if .IsTranslated -}}
                    {{- range .AllTranslations -}}
                        <a href="{{ .Permalink }}"
                           lang="{{ .Language.Lang }}"
                           class="{{ if eq $.Language.Lang .Language.Lang }}active{{ end }}">
                            {{ upper .Language.Lang }}
                        </a>
                    {{- end -}}
                {{- else -}}
                    {{- /* Fallback to homepage links if no translations */ -}}
                    <a href="/en/" class="{{ if eq .Site.Language.Lang "en" }}active{{ end }}">EN</a>
                    <a href="/ko/" class="{{ if eq .Site.Language.Lang "ko" }}active{{ end }}">KO</a>
                    <a href="/ja/" class="{{ if eq .Site.Language.Lang "ja" }}active{{ end }}">JA</a>
                {{- end -}}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Site H1 (SEO requirement: one H1 per page) -->
        <h1 class="site-main-heading" style="position: absolute; left: -9999px; top: -9999px;">{{ .Site.Title }} - {{ .Site.Params.description }}</h1>

        <div class="bento-grid">
            {{ $allPages := where .Site.RegularPages "Language.Lang" .Site.Language.Lang }}
            {{ $currentLangPages := where $allPages "Type" "!=" "page" }}

            <!-- Hero Featured Post (12 columns, full width) -->
            {{ $featured := index $currentLangPages 0 }}
            {{ with $featured }}
            <a href="{{ .Permalink }}" class="featured-post">
                <div class="featured-thumbnail">
                    {{ with .Resources.GetMatch "cover.*" }}
                      {{ $hero := .Fill "1400x350 webp q85" }}
                      {{ $hero2x := .Fill "2800x700 webp q85" }}
                      {{ $fallback := .Fill "1400x350 jpg q85" }}

                      <picture>
                        <source
                          srcset="{{ $hero.RelPermalink }} 1x,
                                  {{ $hero2x.RelPermalink }} 2x"
                          type="image/webp"
                        >
                        <img
                          src="{{ $fallback.RelPermalink }}"
                          alt="{{ $.Title }}"
                          loading="eager"
                        >
                      </picture>
                    {{ else }}
                      {{ with .Params.image }}
                        <img
                          src="{{ . }}"
                          alt="{{ $.Title }}"
                          loading="eager"
                          style="width: 100%; height: 100%; object-fit: cover; object-position: center;"
                        >
                      {{ else }}
                        üì∞ Featured
                      {{ end }}
                    {{ end }}
                </div>
                <div class="featured-content">
                    <span class="featured-badge">Featured</span>
                    <h2 class="featured-title">{{ .Title }}</h2>
                    <p class="featured-excerpt">{{ .Summary | plainify | truncate 200 }}</p>
                    <div class="featured-meta">
                        <span class="featured-date">
                            {{ if eq .Site.Language.Lang "ko" }}
                                {{ .Date.Format "2006ÎÖÑ 01Ïõî 02Ïùº" }}
                            {{ else if eq .Site.Language.Lang "ja" }}
                                {{ .Date.Format "2006Âπ¥01Êúà02Êó•" }}
                            {{ else }}
                                {{ .Date.Format "January 02, 2006" }}
                            {{ end }}
                        </span>
                        {{ if .Params.categories }}
                        <span class="featured-category">{{ index .Params.categories 0 }}</span>
                        {{ end }}
                    </div>
                </div>
            </a>
            {{ end }}

            <!-- Post Cards Grid (6 cards, 3x2 grid, skip Featured post) -->
            {{ range after 1 $currentLangPages | first 6 }}
            <a href="{{ .Permalink }}" class="post-card">
                <div class="post-card-thumbnail">
                    {{ with .Resources.GetMatch "cover.*" }}
                      {{ $card := .Fill "400x180 webp q85" }}
                      {{ $card2x := .Fill "800x360 webp q85" }}
                      {{ $fallback := .Fill "400x180 jpg q85" }}

                      <picture>
                        <source
                          srcset="{{ $card.RelPermalink }} 1x,
                                  {{ $card2x.RelPermalink }} 2x"
                          type="image/webp"
                        >
                        <img
                          src="{{ $fallback.RelPermalink }}"
                          alt="{{ $.Title }}"
                          loading="lazy"
                        >
                      </picture>
                    {{ else }}
                      {{ with .Params.image }}
                        <img
                          src="{{ . }}"
                          alt="{{ $.Title }}"
                          loading="lazy"
                          style="width: 100%; height: 100%; object-fit: cover; object-position: center;"
                        >
                      {{ else }}
                        üìÑ
                      {{ end }}
                    {{ end }}
                </div>
                <div class="post-card-content">
                    <h3 class="post-card-title">{{ .Title }}</h3>
                    <p class="post-card-excerpt">{{ .Summary | plainify | truncate 120 }}</p>
                    <div class="post-card-meta">
                        <span class="post-card-date">
                            {{ if eq $.Site.Language.Lang "ko" }}
                                {{ .Date.Format "2006.01.02" }}
                            {{ else if eq $.Site.Language.Lang "ja" }}
                                {{ .Date.Format "2006.01.02" }}
                            {{ else }}
                                {{ .Date.Format "Jan 02, 2006" }}
                            {{ end }}
                        </span>
                        {{ with .Params.categories }}
                            {{ range first 1 . }}
                            <span class="post-card-category">{{ . }}</span>
                            {{ end }}
                        {{ end }}
                    </div>
                </div>
            </a>
            {{ end }}

            <!-- Latest Updates Section (12 columns, full width) -->
            <div class="latest-updates-section">
                <div class="latest-updates-content">
                    {{ range $index, $page := after 7 (first 15 $currentLangPages) }}
                    <a href="{{ $page.Permalink }}" class="latest-updates-item">
                        <div class="latest-updates-number">{{ printf "%02d" (add $index 8) }}</div>
                        <div class="latest-updates-text">
                            <div class="latest-updates-title">{{ $page.Title }}</div>
                            <div class="latest-updates-date">
                                {{ if eq $.Site.Language.Lang "ko" }}
                                    {{ $page.Date.Format "2006.01.02" }}
                                {{ else if eq $.Site.Language.Lang "ja" }}
                                    {{ $page.Date.Format "2006.01.02" }}
                                {{ else }}
                                    {{ $page.Date.Format "Jan 02, 2006" }}
                                {{ end }}
                            </div>
                        </div>
                    </a>
                    {{ end }}
                </div>
                <a href="{{ "all-posts" | relLangURL }}" class="view-all-cta">
                    <div class="view-all-icon">üìö</div>
                    <div class="view-all-text">
                        {{ if eq .Site.Language.Lang "ko" }}
                        Ï†ÑÏ≤¥<br>Í∏Ä Î≥¥Í∏∞
                        {{ else if eq .Site.Language.Lang "ja" }}
                        „Åô„Åπ„Å¶„ÅÆ<br>Ë®ò‰∫ã
                        {{ else }}
                        View All<br>Articles
                        {{ end }}
                    </div>
                    <div class="view-all-arrow">‚Üí</div>
                </a>
            </div>

            <!-- Trending Section (8 columns) -->
            <div class="trending-section">
                <h3 class="widget-title">Trending</h3>
                <div class="trending-grid">
                    {{ range $index, $page := after 9 (first 13 $currentLangPages) }}
                    <a href="{{ $page.Permalink }}" class="trending-item">
                        <div class="trending-number">{{ printf "%02d" (add $index 1) }}</div>
                        <div class="trending-content">
                            <div class="trending-title">{{ $page.Title }}</div>
                            <div class="trending-date">
                                {{ if eq $.Site.Language.Lang "ko" }}
                                    {{ $page.Date.Format "2006.01.02" }}
                                {{ else if eq $.Site.Language.Lang "ja" }}
                                    {{ $page.Date.Format "2006.01.02" }}
                                {{ else }}
                                    {{ $page.Date.Format "Jan 02, 2006" }}
                                {{ end }}
                            </div>
                        </div>
                    </a>
                    {{ end }}
                </div>
            </div>

            <!-- Popular Tags Section (4 columns) -->
            <div class="tags-section">
                <h3 class="widget-title">Popular Tags</h3>
                <div class="tags-cloud">
                    {{ range first 12 .Site.Taxonomies.tags.ByCount }}
                    <a href="{{ .Page.Permalink }}" class="tag-item">
                        {{ .Page.Title }} <span class="tag-count">{{ .Count }}</span>
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Menu -->
    <div class="floating-menu">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="menu-panel" id="menuPanel">
            <a href="#top">‚Üë Top</a>
            <a href="{{ "all-posts" | relLangURL }}" style="color: var(--accent); font-weight: 600;">üìã {{ i18n "see_all" }}</a>
            <div style="border-top: 1px solid var(--border); margin: 0.5rem 0; padding-top: 0.5rem;">
                <div style="font-size: 0.75rem; color: var(--accent); padding: 0 1rem 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Categories</div>
                <div class="category-grid">
                {{ if eq .Site.Language.Lang "en" }}
                <a href="/categories/tech/"><span class="cat-icon">üíª</span><span class="cat-text">Tech</span></a>
                <a href="/categories/business/"><span class="cat-icon">üíº</span><span class="cat-text">Business</span></a>
                <a href="/categories/society/"><span class="cat-icon">üåç</span><span class="cat-text">Society</span></a>
                <a href="/categories/entertainment/"><span class="cat-icon">üé¨</span><span class="cat-text">Entertainment</span></a>
                <a href="/categories/sports/"><span class="cat-icon">‚öΩ</span><span class="cat-text">Sports</span></a>
                {{ else }}
                <a href="/{{ .Site.Language.Lang }}/categories/tech/"><span class="cat-icon">üíª</span><span class="cat-text">Tech</span></a>
                <a href="/{{ .Site.Language.Lang }}/categories/business/"><span class="cat-icon">üíº</span><span class="cat-text">Business</span></a>
                <a href="/{{ .Site.Language.Lang }}/categories/society/"><span class="cat-icon">üåç</span><span class="cat-text">Society</span></a>
                <a href="/{{ .Site.Language.Lang }}/categories/entertainment/"><span class="cat-icon">üé¨</span><span class="cat-text">Entertainment</span></a>
                <a href="/{{ .Site.Language.Lang }}/categories/sports/"><span class="cat-icon">‚öΩ</span><span class="cat-text">Sports</span></a>
                {{ end }}
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    {{ partial "footer.html" . }}

    <script>
        function toggleMenu() {
            const panel = document.getElementById('menuPanel');
            panel.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.querySelector('.floating-menu');
            if (!menu.contains(event.target)) {
                document.getElementById('menuPanel').classList.remove('active');
            }
        });

    </script>

    <!-- GA4 Event Tracking -->
    {{ partial "ga4-events.html" . }}
</body>
</html>
