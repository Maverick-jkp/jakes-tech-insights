{{ define "main" }}
<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} - {{ .Site.Title }}</title>

    {{- /* Generate multilingual meta description */ -}}
    {{- $totalPosts := len .Site.RegularPages -}}
    {{- $metaDescription := "" -}}
    {{- if eq .Site.Language.Lang "ko" -}}
        {{- $metaDescription = printf "%dê°œì˜ ê¸€ë¡œ êµ¬ì„±ëœ ì „ì²´ ì•„ì¹´ì´ë¸Œì…ë‹ˆë‹¤. ê¸°ìˆ , ë¹„ì¦ˆë‹ˆìŠ¤, ì‚¬íšŒ, ì—”í„°í…Œì¸ë¨¼íŠ¸, ìŠ¤í¬ì¸  ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ì¸ì‚¬ì´íŠ¸ë¥¼ í•œ ê³³ì—ì„œ ë§Œë‚˜ë³´ì„¸ìš”." $totalPosts -}}
    {{- else if eq .Site.Language.Lang "ja" -}}
        {{- $metaDescription = printf "%dä»¶ã®è¨˜äº‹ã§æ§‹æˆã•ã‚ŒãŸå®Œå…¨ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã€ãƒ“ã‚¸ãƒã‚¹ã€ç¤¾ä¼šã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆã€ã‚¹ãƒãƒ¼ãƒ„ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ä¸€ç®‡æ‰€ã§ã€‚" $totalPosts -}}
    {{- else -}}
        {{- $metaDescription = printf "Complete archive of all %d articles. Explore insights across Tech, Business, Society, Entertainment, and Sports categories in one place." $totalPosts -}}
    {{- end -}}

    <meta name="description" content="{{ $metaDescription }}">
    <meta name="author" content="{{ .Site.Params.author }}">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}" />

    <!-- Hreflang for multilingual SEO -->
    {{ partial "hreflang.html" . }}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ .Title }} - {{ .Site.Title }}">
    <meta property="og:description" content="{{ $metaDescription }}">
    <meta property="og:image" content="{{ .Site.BaseURL }}/favicon.svg">
    <meta property="og:site_name" content="{{ .Site.Title }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ .Permalink }}">
    <meta name="twitter:title" content="{{ .Title }} - {{ .Site.Title }}">
    <meta name="twitter:description" content="{{ $metaDescription }}">
    <meta name="twitter:image" content="{{ .Site.BaseURL }}/favicon.svg">

    <!-- CollectionPage Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "{{ .Title }}",
      "description": "{{ $metaDescription }}",
      "url": "{{ .Permalink }}",
      "mainEntity": {
        "@type": "ItemList",
        "numberOfItems": {{ $totalPosts }},
        "itemListElement": [
          {{- range $index, $page := first 50 .Site.RegularPages -}}
          {{- if $index }},{{ end }}
          {
            "@type": "ListItem",
            "position": {{ add $index 1 }},
            "url": "{{ $page.Permalink }}",
            "name": "{{ $page.Title }}"
          }
          {{- end -}}
        ]
      },
      "publisher": {
        "@type": "Organization",
        "name": "{{ .Site.Title }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ .Site.BaseURL }}/favicon.svg"
        }
      }
    }
    </script>

    <link rel="stylesheet" href="{{ "css/all-posts.css" | relURL }}">
</head>
<body>
    <!-- Force Dark Theme -->
    <script>
        document.documentElement.setAttribute('data-theme', 'dark');
    </script>

    <!-- Fixed Header -->
    <div class="top-bar">
        <div class="header-box">
            <a href="{{ "/" | relLangURL }}" class="logo">
                JAKE<span class="apostrophe">'</span>S INSIGHTS
            </a>
            <div class="lang-switch">
                <a href="/all-posts/" {{ if eq .Site.Language.Lang "en" }}class="active"{{ end }}>EN</a>
                <a href="/ko/all-posts/" {{ if eq .Site.Language.Lang "ko" }}class="active"{{ end }}>KO</a>
                <a href="/ja/all-posts/" {{ if eq .Site.Language.Lang "ja" }}class="active"{{ end }}>JA</a>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">{{ i18n "all_posts" }}</h1>
            <p class="page-subtitle">{{ .Summary }}</p>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-bar">
            <button class="filter-btn active" data-filter="all">{{ i18n "all_posts" }}</button>
            <button class="filter-btn" data-filter="tech">ğŸ’» Tech</button>
            <button class="filter-btn" data-filter="business">ğŸ’¼ Business</button>
            <button class="filter-btn" data-filter="society">ğŸŒ Society</button>
            <button class="filter-btn" data-filter="entertainment">ğŸ¬ Entertainment</button>
            <button class="filter-btn" data-filter="sports">âš½ Sports</button>
        </div>

        <!-- Posts Grid -->
        <div class="posts-grid" id="postsGrid">
            {{ $currentLangPages := where .Site.RegularPages "Language.Lang" .Site.Language.Lang }}
            {{ $posts := where $currentLangPages "Type" "in" (slice "tech" "business" "society" "entertainment" "sports") }}
            {{ range $posts }}
            <a href="{{ .Permalink }}" class="post-card" data-category="{{ index .Params.categories 0 }}">
                {{ if .Params.image }}
                <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}" class="post-card-thumbnail">
                {{ end }}
                <div class="post-card-content">
                    <div class="post-card-header">
                        <span class="post-card-date">
                            {{ if eq $.Site.Language.Lang "ko" }}
                                {{ .Date.Format "2006.01.02" }}
                            {{ else if eq $.Site.Language.Lang "ja" }}
                                {{ .Date.Format "2006.01.02" }}
                            {{ else }}
                                {{ .Date.Format "Jan 02, 2006" }}
                            {{ end }}
                        </span>
                        <span class="post-card-category">{{ index .Params.categories 0 }}</span>
                    </div>
                    <h2 class="post-card-title">{{ .Title }}</h2>
                    <div class="post-card-excerpt">{{ .Summary | plainify | truncate 150 }}</div>
                </div>
            </a>
            {{ end }}
        </div>
    </div>

    <!-- Footer -->
    {{ partial "footer.html" . }}

    <!-- Floating Menu -->
    <div class="floating-menu">
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
        <div class="menu-panel" id="menuPanel">
            <a href="#top">â†‘ Top</a>
            <a href="{{ "/" | relLangURL }}">{{ i18n "home" }}</a>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">Categories</div>
            <div class="category-grid">
            {{ if eq .Site.Language.Lang "en" }}
            <a href="/categories/tech/"><span class="cat-icon">ğŸ’»</span><span class="cat-text">Tech</span></a>
            <a href="/categories/business/"><span class="cat-icon">ğŸ’¼</span><span class="cat-text">Business</span></a>
            <a href="/categories/society/"><span class="cat-icon">ğŸŒ</span><span class="cat-text">Society</span></a>
            <a href="/categories/entertainment/"><span class="cat-icon">ğŸ¬</span><span class="cat-text">Entertainment</span></a>
            <a href="/categories/sports/"><span class="cat-icon">âš½</span><span class="cat-text">Sports</span></a>
            {{ else }}
            <a href="/{{ .Site.Language.Lang }}/categories/tech/"><span class="cat-icon">ğŸ’»</span><span class="cat-text">Tech</span></a>
            <a href="/{{ .Site.Language.Lang }}/categories/business/"><span class="cat-icon">ğŸ’¼</span><span class="cat-text">Business</span></a>
            <a href="/{{ .Site.Language.Lang }}/categories/society/"><span class="cat-icon">ğŸŒ</span><span class="cat-text">Society</span></a>
            <a href="/{{ .Site.Language.Lang }}/categories/entertainment/"><span class="cat-icon">ğŸ¬</span><span class="cat-text">Entertainment</span></a>
            <a href="/{{ .Site.Language.Lang }}/categories/sports/"><span class="cat-icon">âš½</span><span class="cat-text">Sports</span></a>
            {{ end }}
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const panel = document.getElementById('menuPanel');
            panel.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.querySelector('.floating-menu');
            const panel = document.getElementById('menuPanel');
            if (!menu.contains(event.target) && panel.classList.contains('active')) {
                panel.classList.remove('active');
            }
        });

        // Filter functionality
        const filterButtons = document.querySelectorAll('.filter-btn');
        const postCards = document.querySelectorAll('.post-card');

        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                const filter = this.getAttribute('data-filter');

                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // Filter posts
                postCards.forEach(card => {
                    const category = card.getAttribute('data-category');
                    if (filter === 'all' || category === filter) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

    </script>

    <!-- GA4 Event Tracking -->
    {{ partial "ga4-events.html" . }}
</body>
</html>
{{ end }}
